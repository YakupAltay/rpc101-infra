apiVersion: v1
kind: ConfigMap
metadata:
  name: kong-env
  namespace: {{ .Release.Namespace }}
data:
  # Database Configuration (PostgreSQL HA)
  KONG_DATABASE: "postgres"
  KONG_PG_HOST: "kong-postgres-rw.{{ .Release.Namespace }}.svc.cluster.local"
  KONG_PG_PORT: "5432"
  KONG_PG_DATABASE: "kong"

  # Redis Configuration (Redis HA)
  KONG_REDIS_HOST: "redis.{{ .Release.Namespace }}.svc.cluster.local"
  KONG_REDIS_PORT: "6379"
  KONG_REDIS_DATABASE: "0"
  KONG_REDIS_TIMEOUT: "2000"

  # Kong Configuration
  KONG_PROXY_LISTEN: "0.0.0.0:8000"  # Back to 8000
  KONG_ADMIN_LISTEN: "0.0.0.0:8001"
  KONG_ADMIN_GUI_LISTEN: "0.0.0.0:8002"
  KONG_ADMIN_GUI_URL: "{{ .Values.adminGuiUrl }}"
  KONG_ADMIN_GUI_API_URL: "{{ .Values.adminGuiApiUrl | default (printf "http://localhost:30081") }}"
  KONG_ADMIN_GUI_AUTH: "basic-auth"
  KONG_ADMIN_GUI_SESSION_CONF: '{"secret":"super-secret-key-change-in-production","storage":"kong","cookie_secure":false}'
  KONG_LOG_LEVEL: "info"
  KONG_DATABASE_MIGRATIONS: "off"

  # Proxy Configuration
  KONG_PROXY_ACCESS_LOG: "/dev/stdout"
  KONG_ADMIN_ACCESS_LOG: "/dev/stdout"
  KONG_PROXY_ERROR_LOG: "/dev/stderr"
  KONG_ADMIN_ERROR_LOG: "/dev/stderr"
